package main

func main() {
	ch := make(chan int)
	go func() {
		for i := 0; i < 10; i++ {
			ch <- i
		}
	}()

	for n := range ch {
		println(n)
	}
}

fatal error: all goroutines are asleep - deadlock!

У нас есть две горутины - main и явно запущенная анонимная горутина. После завершения второй - остается только main. Она блокируется на чтении, при этом других горутин нет. Шедулер понимает, что main заблокировалась навсегда (других горутин нет, никаких). При этом она не просто блокируется (как блокируется, например, при чтении файла), а блокируется на mutex.
Шедулер также видит, что в данный момент нет активных M. Такое поведение и вызывает deadlock.

Чтобы исправить данное поведение, необходимо закрывать канал при завершении записи в него. Как один из вариантов, defer close(ch) в начале анонимной горутины.
